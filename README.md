# lab3-scr1
## Вариант задания

По согласованию с преподавателем задание было изменено. Данное задание направлено на выявление возможной ошибки в блоке выборки. Рассматриваться будет блок кода 669-677 в файле "scr1_pipe_ifu.sv". Для выявления ошибки будет использоваться BASE конфигурация, так как ошибка может возникнуть только с отключенной стадией декодирования. В качестве теста будет использоваться тест "hello".

## Результаты работы

* **result/illegal.dump** - дизассемблер теста
* **result/sim.gtkw** - временная диаграмма
* **result/test_results.txt** - результат симуляции
* **result/tracelog_core_0.log** - трейс лог

## Ход работы
Для выявления ошибки в код TCM было добавлено условие, в которм указано, что при чтении из TCM по адресу "0x48117c" будет выдана ошибка чтения. По данному адресу в младших 16-ти битах храянтся старшие 16 бит RVI инструкции.

Ошибка будет проверяться на инструкции "0xfaffe0ef" (jal	ra,480128), расположенной по адресу "0x48117a". Как можно видеть, адрес невыровненный, т.е. старшие 16 бит инструкции должны быть "дочитаны" по адресу "0x48117c". 

Чтение с ошибкой:

![image](https://github.com/lokki11199/scr1/assets/131533616/655a359b-7152-4017-aeed-464d2986e1a1)

Как можно видеть, старшие 16 бит 0xfaff были считаны с ошибкой.

Далее идет отправка инструкции на стадию декодирования. Как можно видеть, выставляется флаг ошибки при чтении инструкции, но флаг, указывающий на ошибку при чтении старших 16 бит, не выставляется

![image](https://github.com/lokki11199/scr1/assets/131533616/32689509-eb48-493c-b886-41957c764282)

Далее можно увидеть, что на стадии выполнения для инструкции по адресу "0x48117a" возникло исключение с кодом 1 (INSTR_ACCESS_FAULT). При этом флаг "instr_fault_rvi_hi" не выставлен. Из-за этого в CSR регистр MTVAL, который содержит указатель на часть инструкции, вызвавшей исключение, записывается адрес начала инструкции, а не части, вызвавшей исключение.

![image](https://github.com/lokki11199/scr1/assets/131533616/e7c24d6c-dd41-4b45-b60e-41e2dac47b82)

