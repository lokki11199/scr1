# lab-scr1-sim
## Вариант задания

Вид исключения | Тест | Reset Vector | Trap Vector | Обработчик
--------------- | ------------- | ------------- | ------------- | ------------- |
Illegal instruction | isa/rv32mi/illegal.S | 0x400 | 0x200 | Вывод строки "illegal"

## Результаты работы

* **result/illegal.dump** - дизассемблер теста
* **result/sim.gtkw** - временная диаграмма
* **result/test_results.txt** - результат симуляции
* **result/tracelog_core_0.log** - трейс лог

## Ход работы
В файле .../scr1/sim/tests/riscv_isa/rv32_tests.inc был оставлен только тест isa/rv32mi/illegal.S.

В файле .../scr1/src/includes/scr1_arch_description.svh вектор сброса SCR1_ARCH_RST_VECTOR был изменен на 0x400, вектор прерываний SCR1_ARCH_MTVEC_BASE
был изменен на 0x200.

В скрипте линковщика .../sim/tests/common/link.ld был изменен адрес обработчика прерываний и добавлена секция ".text.start", находящася по
адресу вектора сброса.

В файле .../sim/tests/common/riscv_macros.h добавлена загрузка строки "Illegal" с именем "MSG_TRAP" и со смещением 0x600 относительно начала
секции ".text". Также в данном файле реализован обработчик прерывания.

## Обработчик прерывания
В начале в регистр a6 загружается адрес в памяти, использующийся для вывода в консоль. Далее в регистр a7 загружается указатель на первый символ
строки "MSG_TRAP". Далее следует цикл, выводящий строку. Каждую итерацию из памяти в регистр a5 считывается байт, хранящий по адресу в регистре a7
Если байт равняется 0, то считается, что строка закончилась, и осуществляется выход из цикла. Иначе осуществляется запись считанного байта в память
по адресу в регистрt a6. Далее осуществляется инкремент адреса на 1 байт. Так как символ ASCII кодируется одним байтом, доступ к памяти осуществляется побайтово.

## Результат симуляции
Вывод в консоль:

![image](https://github.com/lokki11199/scr1/assets/131533616/4d88c7b8-92da-4c2a-99b8-adc14b820b5a)

Установка PC=400 при сбросе:

![image](https://github.com/lokki11199/scr1/assets/131533616/eed6bd5e-5ebc-44d6-a811-2c97d89b22a5)

Получение исключения с кодом 2 (Illegal instruction) и переход по адресу обработчика прерываний (0x200):

![image](https://github.com/lokki11199/scr1/assets/131533616/ea282ba7-2f3e-49c7-8c26-cb89cc9a4c7a)

Запись по адресу 0xf0000000 символа с кодом 49(I):

![image](https://github.com/lokki11199/scr1/assets/131533616/18d43ba1-99be-4cde-88f9-2892ce47e3fb)
