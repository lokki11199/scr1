# lab3-scr1
## Вариант задания

По согласованию с преподавателем задание было изменено. Данное задание направлено на выявление возможной ошибки в блоке выборки. Рассматриваться будет блок кода 669-677 в файле "scr1_pipe_ifu.sv". Для выявления ошибки будет использоваться BASE конфигурация, так как ошибка может возникнуть только с отключенной стадией декодирования. В качестве теста будет использоваться тест "hello".

## Результаты работы

* **result/BASE** - результаты симуляции BASE конфигурации
* **result/MAX** - результаты симуляции BASE конфигурации
* **result/*/err_waveform.gtkw** - сохраненная временная диаграмма (с отображением необходимых сигналов)
* **result/*/simx.vcd** - файл временной диаграммы
* **result/*/hello.dump** - дамп теста
* **result/*/test_results.txt** - результаты теста
* * **result/*/tracelog_core_0.log** - трейс лог

## Ход работы
Для выявления ошибки в код TCM было добавлено условие, в которм указано, что при чтении из TCM по адресу "0x48117c" будет выдана ошибка чтения. По данному адресу в младших 16-ти битах храянтся старшие 16 бит RVI инструкции.

Ошибка будет проверяться на инструкции "0xfaffe0ef" (jal	ra,480128), расположенной по адресу "0x48117a". Как можно видеть, адрес невыровненный, т.е. старшие 16 бит инструкции должны быть "дочитаны" по адресу "0x48117c". 

Чтение с ошибкой:

![image](https://github.com/lokki11199/scr1/assets/131533616/655a359b-7152-4017-aeed-464d2986e1a1)

Как можно видеть, старшие 16 бит 0xfaff были считаны с ошибкой.

Далее идет отправка инструкции в блок декодирования. Как можно видеть, выставляется флаг ошибки при чтении инструкции, но флаг, указывающий на ошибку при чтении старших 16 бит, не выставляется:

![image](https://github.com/lokki11199/scr1/assets/131533616/32689509-eb48-493c-b886-41957c764282)

Далее можно увидеть, что на стадии выполнения для инструкции по адресу "0x48117a" возникло исключение с кодом 1 (INSTR_ACCESS_FAULT). При этом флаг "instr_fault_rvi_hi" не выставлен. Из-за этого в CSR регистр MTVAL, который содержит указатель на часть инструкции, вызвавшей исключение, записывается адрес начала инструкции, а не части, вызвавшей исключение.

![image](https://github.com/lokki11199/scr1/assets/131533616/e7c24d6c-dd41-4b45-b60e-41e2dac47b82)

Далее приведен результат симуляции для MAX конфигруации ядра, в которой ошибки не было выявлено.

Чтение с ошибкой:

![image](https://github.com/lokki11199/scr1/assets/131533616/a878bba0-e440-463a-b2ca-2735fcbf1cf2)

Передача в блок декодирования считанной инструкции с выстваленным флагом, указывающим на ошибку при чтении старших 16 бит:

![image](https://github.com/lokki11199/scr1/assets/131533616/be6d0725-db37-4ec7-a9c8-4583db5e5646)

Выстваление флагов ошибки на стадии выполнения и запись в MTVAL адреса части инструкции, вызвавшей исключение:

![image](https://github.com/lokki11199/scr1/assets/131533616/eb6c74fb-ee1f-4c47-97bc-3d76fea714da)


